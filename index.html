<!DOCTYPE html>
<html lang="pt-BR" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Classifica√ß√£o SESAP - Google-First</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Chosen Palette: Existing palette remains -->
    <!-- Application Structure Plan: This is a Single-Page Application (SPA) designed exclusively with Google products. It uses Firebase Hosting for deployment, Cloud Firestore for real-time data storage, and Firebase Authentication for user management (anonymous for persistence). The UI remains tabbed for regional classification, with an admin panel for data management. All JavaScript is in one file for simplified deployment. -->
    <!-- Visualization & Content Choices: Standard forms and dynamic lists for candidate classification. Notification system for user feedback. Custom confirmation modal for actions like data clearing. Debug IDs (userBrowserId) are displayed in the admin panel. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #F8F7F4; color: #333333; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .tab-button.active { background-color: #3B82F6; color: white; }
        .admin-panel { display: none; }
        .admin-panel.active { display: block; }
        /* CSS para o modal de confirma√ß√£o */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: none; /* Garante que o modal esteja oculto por padr√£o */
            align-items: center;
            justify-content: center;
            z-index: 50;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .modal-overlay.visible { /* Classe para tornar o modal vis√≠vel */
            display: flex;
            opacity: 1;
            visibility: visible;
        }
        .modal-content-custom { background-color: white; padding: 2rem; border-radius: 0.5rem; max-width: 400px; width: 90%; text-align: center; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto p-4">
        <div class="bg-white rounded-lg shadow-lg">
            <!-- Header -->
            <div class="bg-blue-600 text-white p-6 rounded-t-lg">
                <div class="flex justify-between items-center">
                    <div>
                        <h1 class="text-3xl font-bold flex items-center">
                            <i class="fas fa-hospital mr-3"></i>
                            Classifica√ß√£o SESAP
                        </h1>
                        <p class="text-blue-100 mt-2">Sistema de Classifica√ß√£o por Regi√µes com Banco de Dados</p>
                    </div>
                    <button id="adminToggle" class="bg-blue-800 hover:bg-blue-900 px-4 py-2 rounded-lg transition">
                        <i class="fas fa-cog mr-2"></i>Administra√ß√£o
                    </button>
                </div>
            </div>

            <!-- Admin Panel -->
            <div id="adminPanel" class="admin-panel bg-gray-50 p-6 border-b">
                <h3 class="text-lg font-semibold mb-4 text-gray-800">
                    <i class="fas fa-database mr-2"></i>Gerenciamento de Banco de Dados
                </h3>
                <div class="grid md:grid-cols-4 gap-4">
                    <button id="backupBtn" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition">
                        <i class="fas fa-download mr-2"></i>Backup JSON
                    </button>
                    <button id="restoreBtn" class="bg-yellow-600 hover:bg-yellow-700 text-white px-4 py-2 rounded-lg transition">
                        <i class="fas fa-upload mr-2"></i>Restaurar
                    </button>
                    <button id="exportCsvBtn" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg transition">
                        <i class="fas fa-file-csv mr-2"></i>Exportar CSV
                    </button>
                    <button id="clearAllBtn" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg transition">
                        <i class="fas fa-trash mr-2"></i>Limpar Tudo
                    </button>
                </div>
                <input type="file" id="restoreFile" accept=".json" class="hidden">
                
                <div class="mt-4 p-4 bg-white rounded-lg border">
                    <h4 class="font-semibold text-gray-700 mb-2">Status do Banco de Dados:</h4>
                    <div id="dbStatus" class="text-sm text-gray-600"></div>
                </div>
                <!-- Exibi√ß√£o do userBrowserId para debug (opcional, para ser removido em produ√ß√£o) -->
                <div class="mt-2 text-xs text-gray-500">
                    ID do Navegador: <span id="userBrowserIdDisplay">Carregando...</span>
                </div>
            </div>

            <div class="flex flex-wrap border-b bg-gray-50">
                <button class="tab-button active px-6 py-3 font-medium text-gray-700 hover:bg-gray-200 transition" data-region="1">
                    <i class="fas fa-map-marker-alt mr-2"></i>Regi√£o 1
                </button>
                <button class="tab-button px-6 py-3 font-medium text-gray-700 hover:bg-gray-200 transition" data-region="2">
                    <i class="fas fa-map-marker-alt mr-2"></i>Regi√£o 2
                </button>
                <button class="tab-button px-6 py-3 font-medium text-gray-700 hover:bg-gray-200 transition" data-region="3">
                    <i class="fas fa-map-marker-alt mr-2"></i>Regi√£o 3
                </button>
                <button class="tab-button px-6 py-3 font-medium text-gray-700 hover:bg-gray-200 transition" data-region="4">
                    <i class="fas fa-map-marker-alt mr-2"></i>Regi√£o 4
                </button>
                <button class="tab-button px-6 py-3 font-medium text-gray-700 hover:bg-gray-200 transition" data-region="5">
                    <i class="fas fa-map-marker-alt mr-2"></i>Regi√£o 5
                </button>
                <button class="tab-button px-6 py-3 font-medium text-gray-700 hover:bg-gray-200 transition" data-region="6">
                    <i class="fas fa-map-marker-alt mr-2"></i>Regi√£o 6
                </button>
                <button class="tab-button px-6 py-3 font-medium text-gray-700 hover:bg-gray-200 transition" data-region="7">
                    <i class="fas fa-map-marker-alt mr-2"></i>Regi√£o 7
                </button>
                <button class="tab-button px-6 py-3 font-medium text-gray-700 hover:bg-gray-200 transition" data-region="8">
                    <i class="fas fa-map-marker-alt mr-2"></i>Regi√£o 8
                </button>
            </div>

            <div class="p-6">
                <div class="tab-content active" data-region="1">
                    <div class="grid lg:grid-cols-2 gap-8">
                        <div class="bg-gray-50 p-6 rounded-lg border">
                            <h3 class="text-xl font-semibold mb-4 text-gray-800">
                                <i class="fas fa-user-plus mr-2 text-blue-600"></i>Cadastro de Candidato - Regi√£o 1
                            </h3>
                            <form class="candidate-form space-y-4" data-region="1">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        <i class="fas fa-user mr-2"></i>Nome do Candidato
                                    </label>
                                    <input type="text" name="nome" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        <i class="fas fa-star mr-2"></i>Pontua√ß√£o
                                    </label>
                                    <input type="number" name="pontuacao" required step="0.01" min="0" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        <i class="fas fa-list mr-2"></i>Tipo de Vaga
                                    </label>
                                    <select name="tipo" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                        <option value="">Selecione o tipo</option>
                                        <option value="ampla">üèÜ Ampla Concorr√™ncia</option>
                                        <option value="pcd">‚ôø PCD (Pessoa com Defici√™ncia)</option>
                                        <option value="ppp">üéØ PPP (Pessoa Preto ou Pardo)</option>
                                    </select>
                                </div>
                                <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 px-6 rounded-lg font-medium transition">
                                    <i class="fas fa-check mr-2"></i>Finalizar Cadastro
                                </button>
                            </form>
                        </div>

                        <div class="space-y-6">
                            <div class="bg-white border rounded-lg">
                                <div class="bg-yellow-500 text-white p-4 rounded-t-lg">
                                    <h4 class="font-semibold flex items-center">
                                        üèÜ Ampla Concorr√™ncia - Regi√£o 1
                                        <span class="ml-auto bg-yellow-600 px-2 py-1 rounded text-sm" data-count="ampla-1">0</span>
                                    </h4>
                                </div>
                                <div class="lista-candidatos max-h-64 overflow-y-auto" data-region="1" data-tipo="ampla"></div>
                            </div>

                            <div class="bg-white border rounded-lg">
                                <div class="bg-green-500 text-white p-4 rounded-t-lg">
                                    <h4 class="font-semibold flex items-center">
                                        ‚ôø PCD - Regi√£o 1
                                        <span class="ml-auto bg-green-600 px-2 py-1 rounded text-sm" data-count="pcd-1">0</span>
                                    </h4>
                                </div>
                                <div class="lista-candidatos max-h-64 overflow-y-auto" data-region="1" data-tipo="pcd"></div>
                            </div>

                            <div class="bg-purple-500 text-white p-4 rounded-t-lg">
                                <h4 class="font-semibold flex items-center">
                                        üéØ PPP - Regi√£o 1
                                        <span class="ml-auto bg-purple-600 px-2 py-1 rounded text-sm" data-count="ppp-1">0</span>
                                    </h4>
                                </div>
                                <div class="lista-candidatos max-h-64 overflow-y-auto" data-region="1" data-tipo="ppp"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="tab-content" data-region="2">
                    <div class="grid lg:grid-cols-2 gap-8">
                        <div class="bg-gray-50 p-6 rounded-lg border">
                            <h3 class="text-xl font-semibold mb-4 text-gray-800">
                                <i class="fas fa-user-plus mr-2 text-blue-600"></i>Cadastro de Candidato - Regi√£o 2
                            </h3>
                            <form class="candidate-form space-y-4" data-region="2">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        <i class="fas fa-user mr-2"></i>Nome do Candidato
                                    </label>
                                    <input type="text" name="nome" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        <i class="fas fa-star mr-2"></i>Pontua√ß√£o
                                    </label>
                                    <input type="number" name="pontuacao" required step="0.01" min="0" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        <i class="fas fa-list mr-2"></i>Tipo de Vaga
                                    </label>
                                    <select name="tipo" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                        <option value="">Selecione o tipo</option>
                                        <option value="ampla">üèÜ Ampla Concorr√™ncia</option>
                                        <option value="pcd">‚ôø PCD (Pessoa com Defici√™ncia)</option>
                                        <option value="ppp">üéØ PPP (Pessoa Preto ou Pardo)</option>
                                    </select>
                                </div>
                                <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 px-6 rounded-lg font-medium transition">
                                    <i class="fas fa-check mr-2"></i>Finalizar Cadastro
                                </button>
                            </form>
                        </div>
                        <div class="space-y-6">
                            <div class="bg-white border rounded-lg">
                                <div class="bg-yellow-500 text-white p-4 rounded-t-lg">
                                    <h4 class="font-semibold flex items-center">
                                        üèÜ Ampla Concorr√™ncia - Regi√£o 2
                                        <span class="ml-auto bg-yellow-600 px-2 py-1 rounded text-sm" data-count="ampla-2">0</span>
                                    </h4>
                                </div>
                                <div class="lista-candidatos max-h-64 overflow-y-auto" data-region="2" data-tipo="ampla"></div>
                            </div>
                            <div class="bg-white border rounded-lg">
                                <div class="bg-green-500 text-white p-4 rounded-t-lg">
                                    <h4 class="font-semibold flex items-center">
                                        ‚ôø PCD - Regi√£o 2
                                        <span class="ml-auto bg-green-600 px-2 py-1 rounded text-sm" data-count="pcd-2">0</span>
                                    </h4>
                                </div>
                                <div class="lista-candidatos max-h-64 overflow-y-auto" data-region="2" data-tipo="pcd"></div>
                            </div>
                            <div class="bg-purple-500 text-white p-4 rounded-t-lg">
                                <h4 class="font-semibold flex items-center">
                                        üéØ PPP - Regi√£o 2
                                        <span class="ml-auto bg-purple-600 px-2 py-1 rounded text-sm" data-count="ppp-2">0</span>
                                    </h4>
                                </div>
                                <div class="lista-candidatos max-h-64 overflow-y-auto" data-region="2" data-tipo="ppp"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="tab-content" data-region="3">
                    <div class="grid lg:grid-cols-2 gap-8">
                        <div class="bg-gray-50 p-6 rounded-lg border">
                            <h3 class="text-xl font-semibold mb-4 text-gray-800">
                                <i class="fas fa-user-plus mr-2 text-blue-600"></i>Cadastro de Candidato - Regi√£o 3
                            </h3>
                            <form class="candidate-form space-y-4" data-region="3">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        <i class="fas fa-user mr-2"></i>Nome do Candidato
                                    </label>
                                    <input type="text" name="nome" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        <i class="fas fa-star mr-2"></i>Pontua√ß√£o
                                    </label>
                                    <input type="number" name="pontuacao" required step="0.01" min="0" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        <i class="fas fa-list mr-2"></i>Tipo de Vaga
                                    </label>
                                    <select name="tipo" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                        <option value="">Selecione o tipo</option>
                                        <option value="ampla">üèÜ Ampla Concorr√™ncia</option>
                                        <option value="pcd">‚ôø PCD (Pessoa com Defici√™ncia)</option>
                                        <option value="ppp">üéØ PPP (Pessoa Preto ou Pardo)</option>
                                    </select>
                                </div>
                                <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 px-6 rounded-lg font-medium transition">
                                    <i class="fas fa-check mr-2"></i>Finalizar Cadastro
                                </button>
                            </form>
                        </div>
                        <div class="space-y-6">
                            <div class="bg-white border rounded-lg">
                                <div class="bg-yellow-500 text-white p-4 rounded-t-lg">
                                    <h4 class="font-semibold flex items-center">
                                        üèÜ Ampla Concorr√™ncia - Regi√£o 3
                                        <span class="ml-auto bg-yellow-600 px-2 py-1 rounded text-sm" data-count="ampla-3">0</span>
                                    </h4>
                                </div>
                                <div class="lista-candidatos max-h-64 overflow-y-auto" data-region="3" data-tipo="ampla"></div>
                            </div>
                            <div class="bg-white border rounded-lg">
                                <div class="bg-green-500 text-white p-4 rounded-t-lg">
                                    <h4 class="font-semibold flex items-center">
                                        ‚ôø PCD - Regi√£o 3
                                        <span class="ml-auto bg-green-600 px-2 py-1 rounded text-sm" data-count="pcd-3">0</span>
                                    </h4>
                                </div>
                                <div class="lista-candidatos max-h-64 overflow-y-auto" data-region="3" data-tipo="pcd"></div>
                            </div>
                            <div class="bg-purple-500 text-white p-4 rounded-t-lg">
                                <h4 class="font-semibold flex items-center">
                                        üéØ PPP - Regi√£o 3
                                        <span class="ml-auto bg-purple-600 px-2 py-1 rounded text-sm" data-count="ppp-3">0</span>
                                    </h4>
                                </div>
                                <div class="lista-candidatos max-h-64 overflow-y-auto" data-region="3" data-tipo="ppp"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="tab-content" data-region="4">
                    <div class="grid lg:grid-cols-2 gap-8">
                        <div class="bg-gray-50 p-6 rounded-lg border">
                            <h3 class="text-xl font-semibold mb-4 text-gray-800">
                                <i class="fas fa-user-plus mr-2 text-blue-600"></i>Cadastro de Candidato - Regi√£o 4
                            </h3>
                            <form class="candidate-form space-y-4" data-region="4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        <i class="fas fa-user mr-2"></i>Nome do Candidato
                                    </label>
                                    <input type="text" name="nome" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        <i class="fas fa-star mr-2"></i>Pontua√ß√£o
                                    </label>
                                    <input type="number" name="pontuacao" required step="0.01" min="0" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        <i class="fas fa-list mr-2"></i>Tipo de Vaga
                                    </label>
                                    <select name="tipo" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                        <option value="">Selecione o tipo</option>
                                        <option value="ampla">üèÜ Ampla Concorr√™ncia</option>
                                        <option value="pcd">‚ôø PCD (Pessoa com Defici√™ncia)</option>
                                        <option value="ppp">üéØ PPP (Pessoa Preto ou Pardo)</option>
                                    </select>
                                </div>
                                <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 px-6 rounded-lg font-medium transition">
                                    <i class="fas fa-check mr-2"></i>Finalizar Cadastro
                                </button>
                            </form>
                        </div>
                        <div class="space-y-6">
                            <div class="bg-white border rounded-lg">
                                <div class="bg-yellow-500 text-white p-4 rounded-t-lg">
                                    <h4 class="font-semibold flex items-center">
                                        üèÜ Ampla Concorr√™ncia - Regi√£o 4
                                        <span class="ml-auto bg-yellow-600 px-2 py-1 rounded text-sm" data-count="ampla-4">0</span>
                                    </h4>
                                </div>
                                <div class="lista-candidatos max-h-64 overflow-y-auto" data-region="4" data-tipo="ampla"></div>
                            </div>
                            <div class="bg-white border rounded-lg">
                                <div class="bg-green-500 text-white p-4 rounded-t-lg">
                                    <h4 class="font-semibold flex items-center">
                                        ‚ôø PCD - Regi√£o 4
                                        <span class="ml-auto bg-green-600 px-2 py-1 rounded text-sm" data-count="pcd-4">0</span>
                                    </h4>
                                </div>
                                <div class="lista-candidatos max-h-64 overflow-y-auto" data-region="4" data-tipo="pcd"></div>
                            </div>
                            <div class="bg-purple-500 text-white p-4 rounded-t-lg">
                                <h4 class="font-semibold flex items-center">
                                        üéØ PPP - Regi√£o 4
                                        <span class="ml-auto bg-purple-600 px-2 py-1 rounded text-sm" data-count="ppp-4">0</span>
                                    </h4>
                                </div>
                                <div class="lista-candidatos max-h-64 overflow-y-auto" data-region="4" data-tipo="ppp"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="tab-content" data-region="5">
                    <div class="grid lg:grid-cols-2 gap-8">
                        <div class="bg-gray-50 p-6 rounded-lg border">
                            <h3 class="text-xl font-semibold mb-4 text-gray-800">
                                <i class="fas fa-user-plus mr-2 text-blue-600"></i>Cadastro de Candidato - Regi√£o 5
                            </h3>
                            <form class="candidate-form space-y-4" data-region="5">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        <i class="fas fa-user mr-2"></i>Nome do Candidato
                                    </label>
                                    <input type="text" name="nome" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        <i class="fas fa-star mr-2"></i>Pontua√ß√£o
                                    </label>
                                    <input type="number" name="pontuacao" required step="0.01" min="0" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        <i class="fas fa-list mr-2"></i>Tipo de Vaga
                                    </label>
                                    <select name="tipo" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                        <option value="">Selecione o tipo</option>
                                        <option value="ampla">üèÜ Ampla Concorr√™ncia</option>
                                        <option value="pcd">‚ôø PCD (Pessoa com Defici√™ncia)</option>
                                        <option value="ppp">üéØ PPP (Pessoa Preto ou Pardo)</option>
                                    </select>
                                </div>
                                <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 px-6 rounded-lg font-medium transition">
                                    <i class="fas fa-check mr-2"></i>Finalizar Cadastro
                                </button>
                            </form>
                        </div>
                        <div class="space-y-6">
                            <div class="bg-white border rounded-lg">
                                <div class="bg-yellow-500 text-white p-4 rounded-t-lg">
                                    <h4 class="font-semibold flex items-center">
                                        üèÜ Ampla Concorr√™ncia - Regi√£o 5
                                        <span class="ml-auto bg-yellow-600 px-2 py-1 rounded text-sm" data-count="ampla-5">0</span>
                                    </h4>
                                </div>
                                <div class="lista-candidatos max-h-64 overflow-y-auto" data-region="5" data-tipo="ampla"></div>
                            </div>
                            <div class="bg-white border rounded-lg">
                                <div class="bg-green-500 text-white p-4 rounded-t-lg">
                                    <h4 class="font-semibold flex items-center">
                                        ‚ôø PCD - Regi√£o 5
                                        <span class="ml-auto bg-green-600 px-2 py-1 rounded text-sm" data-count="pcd-5">0</span>
                                    </h4>
                                </div>
                                <div class="lista-candidatos max-h-64 overflow-y-auto" data-region="5" data-tipo="pcd"></div>
                            </div>
                            <div class="bg-purple-500 text-white p-4 rounded-t-lg">
                                <h4 class="font-semibold flex items-center">
                                        üéØ PPP - Regi√£o 5
                                        <span class="ml-auto bg-purple-600 px-2 py-1 rounded text-sm" data-count="ppp-5">0</span>
                                    </h4>
                                </div>
                                <div class="lista-candidatos max-h-64 overflow-y-auto" data-region="5" data-tipo="ppp"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="tab-content" data-region="6">
                    <div class="grid lg:grid-cols-2 gap-8">
                        <div class="bg-gray-50 p-6 rounded-lg border">
                            <h3 class="text-xl font-semibold mb-4 text-gray-800">
                                <i class="fas fa-user-plus mr-2 text-blue-600"></i>Cadastro de Candidato - Regi√£o 6
                            </h3>
                            <form class="candidate-form space-y-4" data-region="6">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        <i class="fas fa-user mr-2"></i>Nome do Candidato
                                    </label>
                                    <input type="text" name="nome" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        <i class="fas fa-star mr-2"></i>Pontua√ß√£o
                                    </label>
                                    <input type="number" name="pontuacao" required step="0.01" min="0" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        <i class="fas fa-list mr-2"></i>Tipo de Vaga
                                    </label>
                                    <select name="tipo" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                        <option value="">Selecione o tipo</option>
                                        <option value="ampla">üèÜ Ampla Concorr√™ncia</option>
                                        <option value="pcd">‚ôø PCD (Pessoa com Defici√™ncia)</option>
                                        <option value="ppp">üéØ PPP (Pessoa Preto ou Pardo)</option>
                                    </select>
                                </div>
                                <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 px-6 rounded-lg font-medium transition">
                                    <i class="fas fa-check mr-2"></i>Finalizar Cadastro
                                </button>
                            </form>
                        </div>
                        <div class="space-y-6">
                            <div class="bg-white border rounded-lg">
                                <div class="bg-yellow-500 text-white p-4 rounded-t-lg">
                                    <h4 class="font-semibold flex items-center">
                                        üèÜ Ampla Concorr√™ncia - Regi√£o 6
                                        <span class="ml-auto bg-yellow-600 px-2 py-1 rounded text-sm" data-count="ampla-6">0</span>
                                    </h4>
                                </div>
                                <div class="lista-candidatos max-h-64 overflow-y-auto" data-region="6" data-tipo="ampla"></div>
                            </div>
                            <div class="bg-white border rounded-lg">
                                <div class="bg-green-500 text-white p-4 rounded-t-lg">
                                    <h4 class="font-semibold flex items-center">
                                        ‚ôø PCD - Regi√£o 6
                                        <span class="ml-auto bg-green-600 px-2 py-1 rounded text-sm" data-count="pcd-6">0</span>
                                    </h4>
                                </div>
                                <div class="lista-candidatos max-h-64 overflow-y-auto" data-region="6" data-tipo="pcd"></div>
                            </div>
                            <div class="bg-purple-500 text-white p-4 rounded-t-lg">
                                <h4 class="font-semibold flex items-center">
                                        üéØ PPP - Regi√£o 6
                                        <span class="ml-auto bg-purple-600 px-2 py-1 rounded text-sm" data-count="ppp-6">0</span>
                                    </h4>
                                </div>
                                <div class="lista-candidatos max-h-64 overflow-y-auto" data-region="6" data-tipo="ppp"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="tab-content" data-region="7">
                    <div class="grid lg:grid-cols-2 gap-8">
                        <div class="bg-gray-50 p-6 rounded-lg border">
                            <h3 class="text-xl font-semibold mb-4 text-gray-800">
                                <i class="fas fa-user-plus mr-2 text-blue-600"></i>Cadastro de Candidato - Regi√£o 7
                            </h3>
                            <form class="candidate-form space-y-4" data-region="7">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        <i class="fas fa-user mr-2"></i>Nome do Candidato
                                    </label>
                                    <input type="text" name="nome" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        <i class="fas fa-star mr-2"></i>Pontua√ß√£o
                                    </label>
                                    <input type="number" name="pontuacao" required step="0.01" min="0" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        <i class="fas fa-list mr-2"></i>Tipo de Vaga
                                    </label>
                                    <select name="tipo" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                        <option value="">Selecione o tipo</option>
                                        <option value="ampla">üèÜ Ampla Concorr√™ncia</option>
                                        <option value="pcd">‚ôø PCD (Pessoa com Defici√™ncia)</option>
                                        <option value="ppp">üéØ PPP (Pessoa Preto ou Pardo)</option>
                                    </select>
                                </div>
                                <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 px-6 rounded-lg font-medium transition">
                                    <i class="fas fa-check mr-2"></i>Finalizar Cadastro
                                </button>
                            </form>
                        </div>
                        <div class="space-y-6">
                            <div class="bg-white border rounded-lg">
                                <div class="bg-yellow-500 text-white p-4 rounded-t-lg">
                                    <h4 class="font-semibold flex items-center">
                                        üèÜ Ampla Concorr√™ncia - Regi√£o 7
                                        <span class="ml-auto bg-yellow-600 px-2 py-1 rounded text-sm" data-count="ampla-7">0</span>
                                    </h4>
                                </div>
                                <div class="lista-candidatos max-h-64 overflow-y-auto" data-region="7" data-tipo="ampla"></div>
                            </div>
                            <div class="bg-white border rounded-lg">
                                <div class="bg-green-500 text-white p-4 rounded-t-lg">
                                    <h4 class="font-semibold flex items-center">
                                        ‚ôø PCD - Regi√£o 7
                                        <span class="ml-auto bg-green-600 px-2 py-1 rounded text-sm" data-count="pcd-7">0</span>
                                    </h4>
                                </div>
                                <div class="lista-candidatos max-h-64 overflow-y-auto" data-region="7" data-tipo="pcd"></div>
                            </div>
                            <div class="bg-purple-500 text-white p-4 rounded-t-lg">
                                <h4 class="font-semibold flex items-center">
                                        üéØ PPP - Regi√£o 7
                                        <span class="ml-auto bg-purple-600 px-2 py-1 rounded text-sm" data-count="ppp-7">0</span>
                                    </h4>
                                </div>
                                <div class="lista-candidatos max-h-64 overflow-y-auto" data-region="7" data-tipo="ppp"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="tab-content" data-region="8">
                    <div class="grid lg:grid-cols-2 gap-8">
                        <div class="bg-gray-50 p-6 rounded-lg border">
                            <h3 class="text-xl font-semibold mb-4 text-gray-800">
                                <i class="fas fa-user-plus mr-2 text-blue-600"></i>Cadastro de Candidato - Regi√£o 8
                            </h3>
                            <form class="candidate-form space-y-4" data-region="8">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        <i class="fas fa-user mr-2"></i>Nome do Candidato
                                    </label>
                                    <input type="text" name="nome" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        <i class="fas fa-star mr-2"></i>Pontua√ß√£o
                                    </label>
                                    <input type="number" name="pontuacao" required step="0.01" min="0" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        <i class="fas fa-list mr-2"></i>Tipo de Vaga
                                    </label>
                                    <select name="tipo" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                        <option value="">Selecione o tipo</option>
                                        <option value="ampla">üèÜ Ampla Concorr√™ncia</option>
                                        <option value="pcd">‚ôø PCD (Pessoa com Defici√™ncia)</option>
                                        <option value="ppp">üéØ PPP (Pessoa Preto ou Pardo)</option>
                                    </select>
                                </div>
                                <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 px-6 rounded-lg font-medium transition">
                                    <i class="fas fa-check mr-2"></i>Finalizar Cadastro
                                </button>
                            </form>
                        </div>
                        <div class="space-y-6">
                            <div class="bg-white border rounded-lg">
                                <div class="bg-yellow-500 text-white p-4 rounded-t-lg">
                                    <h4 class="font-semibold flex items-center">
                                        üèÜ Ampla Concorr√™ncia - Regi√£o 8
                                        <span class="ml-auto bg-yellow-600 px-2 py-1 rounded text-sm" data-count="ampla-8">0</span>
                                    </h4>
                                </div>
                                <div class="lista-candidatos max-h-64 overflow-y-auto" data-region="8" data-tipo="ampla"></div>
                            </div>
                            <div class="bg-white border rounded-lg">
                                <div class="bg-green-500 text-white p-4 rounded-t-lg">
                                    <h4 class="font-semibold flex items-center">
                                        ‚ôø PCD - Regi√£o 8
                                        <span class="ml-auto bg-green-600 px-2 py-1 rounded text-sm" data-count="pcd-8">0</span>
                                    </h4>
                                </div>
                                <div class="lista-candidatos max-h-64 overflow-y-auto" data-region="8" data-tipo="pcd"></div>
                            </div>
                            <div class="bg-purple-500 text-white p-4 rounded-t-lg">
                                <h4 class="font-semibold flex items-center">
                                        üéØ PPP - Regi√£o 8
                                        <span class="ml-auto bg-purple-600 px-2 py-1 rounded text-sm" data-count="ppp-8">0</span>
                                    </h4>
                                </div>
                                <div class="lista-candidatos max-h-64 overflow-y-auto" data-region="8" data-tipo="ppp"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="confirmationModal" class="modal-overlay hidden">
        <div class="modal-content-custom">
            <p id="confirmationMessage" class="text-lg font-semibold mb-4"></p>
            <div class="flex justify-around space-x-4">
                <button id="confirmYes" class="bg-red-600 hover:bg-red-700 text-white py-2 px-4 rounded-lg flex-1">Sim</button>
                <button id="confirmNo" class="bg-gray-300 hover:bg-gray-400 text-gray-800 py-2 px-4 rounded-lg flex-1">N√£o</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, getDocs, deleteDoc, onSnapshot, query } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        class FirebaseSESAPDatabase {
            constructor() {
                this.app = null;
                this.auth = null;
                this.db = null;
                this.userBrowserId = null;
                this.firebaseAuthUid = null;
                
                const firebaseConfig = {
                    apiKey: "AIzaSyDW4hzu2kb-UWM--3vFcl6y-7ep-pkAYB4",
                    authDomain: "classificacaosesapweb.firebaseapp.com",
                    projectId: "classificacaosesapweb",
                    storageBucket: "classificacaosesapweb.firebasestorage.app",
                    messagingSenderId: "963297484715",
                    appId: "1:963297484715:web:4aca1acfb5dae3d9de3cee",
                    measurementId: "G-WSVD92QZYQ"
                };

                this.appId = firebaseConfig.appId;
                this.allCandidates = [];
                this.isAuthReady = false;

                this._initializeUserBrowserId();
                this.initializeFirebase(firebaseConfig);
            }

            _initializeUserBrowserId() {
                let id = localStorage.getItem('sesap_user_browser_id');
                if (!id) {
                    id = crypto.randomUUID();
                    localStorage.setItem('sesap_user_browser_id', id);
                }
                this.userBrowserId = id;
                console.log("[FirebaseSESAPDatabase] ID do Navegador (userBrowserId):", this.userBrowserId);
                const userBrowserIdDisplay = document.getElementById('userBrowserIdDisplay');
                if(userBrowserIdDisplay) {
                    userBrowserIdDisplay.textContent = this.userBrowserId;
                }
            }

            async initializeFirebase(firebaseConfig) {
                try {
                    this.app = initializeApp(firebaseConfig);
                    this.auth = getAuth(this.app);
                    this.db = getFirestore(this.app);

                    console.log("[FirebaseSESAPDatabase] Tentando autentica√ß√£o an√¥nima...");
                    // Autentica o utilizador anonimamente.
                    // Isso garante que request.auth.uid exista nas regras de seguran√ßa do Firestore.
                    await signInAnonymously(this.auth);
                    
                    this.firebaseAuthUid = this.auth.currentUser?.uid;
                    this.isAuthReady = true;
                    console.log("[FirebaseSESAPDatabase] Firebase inicializado com sucesso. UID de Autentica√ß√£o Firebase:", this.firebaseAuthUid);
                    
                    this._setupCandidatesListener();
                    
                } catch (error) {
                    console.error("[FirebaseSESAPDatabase] Erro ao inicializar Firebase:", error);
                    showNotification(`Erro ao inicializar Firebase: ${error.message}. Por favor, verifique: 1) Se 'Authentication' est√° habilitado e 'Anonymous' ativado no seu projeto Firebase no console. 2) Se as Origens JavaScript autorizadas est√£o corretas.`, 'error');
                }
            }

            _setupCandidatesListener() {
                if (!this.isAuthReady || !this.userBrowserId || !this.firebaseAuthUid) {
                    console.warn("[FirebaseSESAPDatabase] Firestore n√£o est√° pronto para configurar listener. Aguardando autentica√ß√£o, userBrowserId ou firebaseAuthUid.");
                    return;
                }
                const candidatesCollectionRef = collection(this.db, `artifacts/${this.appId}/browsers/${this.userBrowserId}/candidates`);
                
                console.log(`[FirebaseSESAPDatabase] Configurando listener para: artifacts/${this.appId}/browsers/${this.userBrowserId}/candidates`);

                onSnapshot(candidatesCollectionRef, (snapshot) => {
                    this.allCandidates = [];
                    snapshot.forEach((doc) => {
                        this.allCandidates.push({ id: doc.id, ...doc.data() });
                    });
                    console.log("[FirebaseSESAPDatabase] Dados do Firestore atualizados localmente:", this.allCandidates);
                    this._dispatchDataUpdateEvent();
                }, (error) => {
                    console.error("[FirebaseSESAPDatabase] Erro ao receber atualiza√ß√µes do Firestore:", error);
                    showNotification(`Erro ao carregar dados: ${error.message}. Isso pode ser devido a regras de seguran√ßa insuficientes para leitura.`, 'error');
                });
            }

            _dispatchDataUpdateEvent() {
                const event = new CustomEvent('firebaseDataUpdated');
                document.dispatchEvent(event);
            }

            async addCandidate(region, candidate) {
                if (!this.isAuthReady || !this.userBrowserId || !this.firebaseAuthUid) {
                    const msg = "Firestore n√£o est√° pronto. Candidato n√£o adicionado. (Verifique a conex√£o, autentica√ß√£o ou ID do navegador)";
                    console.error("[FirebaseSESAPDatabase]", msg);
                    return { success: false, error: msg };
                }
                try {
                    const candidatesCollectionRef = collection(this.db, `artifacts/${this.appId}/browsers/${this.userBrowserId}/candidates`);
                    console.log(`[FirebaseSESAPDatabase] Tentando adicionar candidato ao caminho: artifacts/${this.appId}/browsers/${this.userBrowserId}/candidates`);
                    const docData = {
                        ...candidate,
                        region: region,
                        timestamp: new Date().toISOString(),
                        userBrowserId: this.userBrowserId, // Salva o userBrowserId no documento
                        firebaseAuthUid: this.firebaseAuthUid // Salva o UID de autentica√ß√£o do Firebase no documento (para regras)
                    };
                    await addDoc(candidatesCollectionRef, docData);
                    console.log(`[FirebaseSESAPDatabase] Candidato adicionado no Firestore:`, docData);
                    return { success: true };
                }
                catch (e) {
                    const msg = `Erro ao adicionar candidato ao Firestore. Verifique as regras de seguran√ßa do Firestore. Detalhes: ${e.message}`;
                    console.error("[FirebaseSESAPDatabase]", msg, e);
                    return { success: false, error: e.message }; 
                }
            }

            getRegionData(region) {
                const candidatesForRegion = this.allCandidates.filter(c => c.region == region);
                const regionData = { ampla: [], pcd: [], ppp: [] };

                ['ampla', 'pcd', 'ppp'].forEach(tipo => {
                    regionData[tipo] = candidatesForRegion
                                        .filter(c => c.tipo === tipo)
                                        .sort((a, b) => b.pontuacao - a.pontuacao);
                });
                return regionData;
            }

            getAllData() {
                return JSON.parse(JSON.stringify(this.allCandidates));
            }

            async clearAll() {
                if (!this.isAuthReady || !this.userBrowserId || !this.firebaseAuthUid) {
                    const msg = "Firestore n√£o est√° pronto. N√£o √© poss√≠vel limpar os dados. (Verifique a conex√£o, autentica√ß√£o, userBrowserId ou firebaseAuthUid)";
                    console.error("[FirebaseSESAPDatabase]", msg);
                    return { success: false, error: msg };
                }
                try {
                    const candidatesCollectionRef = collection(this.db, `artifacts/${this.appId}/browsers/${this.userBrowserId}/candidates`);
                    const q = query(candidatesCollectionRef);
                    const querySnapshot = await getDocs(q);

                    const deletePromises = [];
                    querySnapshot.forEach((doc) => {
                        deletePromises.push(deleteDoc(doc.ref));
                    });
                    await Promise.all(deletePromises);
                    console.log("[FirebaseSESAPDatabase] Todos os dados foram limpos no Firestore.");
                    return { success: true };
                } catch (e) {
                    const msg = `Erro ao limpar dados do Firestore. Verifique as regras de seguran√ßa do Firestore. Detalhes: ${e.message}`;
                    console.error("[FirebaseSESAPDatabase]", msg, e);
                    return { success: false, error: e.message };
                }
            }

            async restoreData(jsonData) {
                if (!this.isAuthReady || !this.userBrowserId || !this.firebaseAuthUid) {
                    const msg = "Firestore n√£o est√° pronto. N√£o √© poss√≠vel restaurar os dados. (Verifique a conex√£o, autentica√ß√£o, userBrowserId ou firebaseAuthUid)";
                    console.error("[FirebaseSESAPDatabase]", msg);
                    return { success: false, error: msg };
                }
                try {
                    const dataToRestore = JSON.parse(jsonData);
                    
                    if (!dataToRestore || !Array.isArray(dataToRestore)) {
                        const msg = 'Formato de arquivo inv√°lido. Esperado um array de candidatos.';
                        console.error("[FirebaseSESAPDatabase]", msg);
                        return { success: false, error: msg };
                    }

                    const clearResult = await this.clearAll();
                    if (!clearResult.success) {
                        return clearResult;
                    }

                    const candidatesCollectionRef = collection(this.db, `artifacts/${this.appId}/browsers/${this.userBrowserId}/candidates`);
                    const addPromises = [];
                    
                    for (const candidate of dataToRestore) {
                        if (candidate.nome && candidate.pontuacao !== undefined && candidate.tipo && candidate.region) {
                            const docData = {
                                nome: candidate.nome,
                                pontuacao: parseFloat(candidate.pontuacao),
                                tipo: candidate.tipo,
                                region: candidate.region,
                                timestamp: candidate.timestamp || new Date().toISOString(),
                                userBrowserId: this.userBrowserId,
                                firebaseAuthUid: this.firebaseAuthUid
                            };
                            addPromises.push(addDoc(candidatesCollectionRef, docData));
                        } else {
                            console.warn("[FirebaseSESAPDatabase] Candidato inv√°lido no arquivo de restaura√ß√£o, pulando:", candidate);
                        }
                    }
                    await Promise.all(addPromises);
                    console.log('[FirebaseSESAPDatabase] Dados restaurados com sucesso no Firestore!');
                    return { success: true };
                } catch (e) {
                    const msg = `Erro ao restaurar dados no Firestore. Verifique o arquivo e as regras de seguran√ßa. Detalhes: ${e.message}`;
                    console.error("[FirebaseSESAPDatabase]", msg, e);
                    return { success: false, error: e.message };
                }
            }

            exportJSON() {
                return JSON.stringify(this.allCandidates, null, 2);
            }

            exportCSV() {
                let csv = 'Regi√£o,Nome,Pontua√ß√£o,Tipo,Data/Hora\n';
                this.allCandidates.forEach(candidato => {
                    const tipoName = candidato.tipo === 'ampla' ? 'Ampla Concorr√™ncia' : 
                                   candidato.tipo === 'pcd' ? 'PCD' : 'PPP';
                    csv += `${candidato.region},"${candidato.nome}",${candidato.pontuacao},${tipoName},${candidato.timestamp}\n`;
                });
                return csv;
            }
        }

        const db = new FirebaseSESAPDatabase();
        window.db = db; // Expose to global scope for debugging

        let currentActiveRegion = '1';
        const ADMIN_PASSWORD = "Adm1n"; 

        let confirmationModal;
        let confirmationMessage;
        let confirmYes;
        let confirmNo;
        let currentModalCallback = null;

        function setupModalListeners() {
            confirmationModal = document.getElementById('confirmationModal');
            confirmationMessage = document.getElementById('confirmationMessage');
            confirmYes = document.getElementById('confirmYes');
            confirmNo = document.getElementById('confirmNo');

            confirmYes.addEventListener('click', () => {
                if (currentModalCallback) {
                    currentModalCallback(true);
                }
                confirmationModal.classList.remove('visible');
                currentModalCallback = null;
            });

            confirmNo.addEventListener('click', () => {
                if (currentModalCallback) {
                    currentModalCallback(false);
                }
                confirmationModal.classList.remove('visible');
                currentModalCallback = null;
            });

            confirmationModal.addEventListener('click', (e) => {
                if (e.target === confirmationModal) {
                    if (currentModalCallback) { 
                         currentModalCallback(false);
                    }
                    confirmationModal.classList.remove('visible');
                    currentModalCallback = null;
                }
            });
        }

        function updateDbStatusDisplay() {
            const statusDiv = document.getElementById('dbStatus');
            if (db.isAuthReady) {
                const totalCandidatos = db.allCandidates.length;
                statusDiv.innerHTML = `
                    <div class="grid grid-cols-2 gap-4 text-sm">
                        <div><strong>Total de candidatos:</strong> ${totalCandidatos}</div>
                        <div><strong>√öltima atualiza√ß√£o (Firestore):</strong> ${new Date().toLocaleString('pt-BR')}</div>
                    </div>
                `;
            } else {
                statusDiv.innerHTML = '<div class="text-gray-600">Aguardando conex√£o com o banco de dados.</div>';
            }
        }

        function loadRegionData(region) {
            const regionData = db.getRegionData(region);
            ['ampla', 'pcd', 'ppp'].forEach(tipo => {
                const lista = document.querySelector(`.lista-candidatos[data-region="${region}"][data-tipo="${tipo}"]`);
                const counter = document.querySelector(`[data-count="${tipo}-${region}"]`);
                if (lista && counter) {
                    lista.innerHTML = '';
                    counter.textContent = regionData[tipo].length;
                    if (regionData[tipo].length === 0) {
                        lista.innerHTML = '<div class="p-4 text-gray-500 text-center">Nenhum candidato cadastrado</div>';
                    } else {
                        regionData[tipo].forEach((candidato, index) => {
                            const item = document.createElement('div');
                            item.className = 'flex justify-between items-center p-3 border-b border-gray-200 hover:bg-gray-50';
                            item.innerHTML = `
                                <div class="flex items-center space-x-3">
                                    <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-sm font-medium">${index + 1}¬∫</span>
                                    <div>
                                        <div class="font-medium text-gray-900">${candidato.nome}</div>
                                        <div class="text-sm text-gray-500">Cadastrado em: ${new Date(candidato.timestamp).toLocaleString('pt-BR')}</div>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <div class="text-lg font-bold text-gray-900">${candidato.pontuacao.toFixed(2)}</div>
                                    <div class="text-xs text-gray-500">pontos</div>
                                </div>
                            `;
                            lista.appendChild(item);
                        });
                    }
                }
            });
        }

        function showConfirmationModal(message, callback) {
            if (!confirmationModal) { 
                setupModalListeners();
            }
            confirmationMessage.textContent = message;
            currentModalCallback = callback;
            confirmationModal.classList.add('visible');
        }

        function showNotification(message, type = 'info', detailedError = null) {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50 ${
                type === 'success' ? 'bg-green-500 text-white' : 
                type === 'error' ? 'bg-red-500 text-white' : 
                'bg-blue-500 text-white'
            }`;
            notification.innerHTML = `
                <div class="flex items-center">
                    <i class="fas fa-${type === 'success' ? 'check' : type === 'error' ? 'exclamation-triangle' : 'info'} mr-2"></i>
                    <div>
                        ${message}
                        ${detailedError ? `<br><span class="text-xs opacity-75">Detalhes: ${detailedError}</span>` : ''}
                    </div>
                </div>
            `;
            document.body.appendChild(notification);
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        document.addEventListener('DOMContentLoaded', () => {
            setupModalListeners();

            document.addEventListener('firebaseDataUpdated', () => {
                loadRegionData(currentActiveRegion);
                updateDbStatusDisplay();
            });

            document.querySelectorAll('.tab-button').forEach(button => {
                button.addEventListener('click', function() {
                    const region = this.dataset.region;
                    currentActiveRegion = region;
                    document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    this.classList.add('active');
                    document.querySelector(`.tab-content[data-region="${region}"]`).classList.add('active');
                    loadRegionData(region);
                });
            });

            document.querySelectorAll('.candidate-form').forEach(form => {
                form.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    const region = this.dataset.region;
                    const formData = new FormData(this);
                    const candidato = {
                        nome: formData.get('nome'),
                        pontuacao: parseFloat(formData.get('pontuacao')),
                        tipo: formData.get('tipo')
                    };
                    const result = await db.addCandidate(region, candidato);
                    if (result.success) {
                        this.reset();
                        showNotification('Candidato adicionado com sucesso!', 'success');
                    } else {
                        showNotification('Erro ao adicionar candidato.', 'error', result.error);
                    }
                });
            });

            document.getElementById('adminToggle').addEventListener('click', function() {
                const panel = document.getElementById('adminPanel');
                if (panel.classList.contains('active')) {
                    panel.classList.remove('active');
                    this.innerHTML = '<i class="fas fa-cog mr-2"></i>Administra√ß√£o';
                } else {
                    const passwordAttempt = prompt("Por favor, insira a senha de administra√ß√£o:");
                    if (passwordAttempt === ADMIN_PASSWORD) {
                        panel.classList.add('active');
                        this.innerHTML = '<i class="fas fa-times mr-2"></i>Fechar Admin';
                    } else {
                        showNotification('Senha incorreta!', 'error');
                    }
                }
            });

            document.getElementById('backupBtn').addEventListener('click', function() {
                const dataStr = db.exportJSON();
                const dataBlob = new Blob([dataStr], {type:'application/json'});
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `sesap_backup_${new Date().toISOString().split('T')[0]}.json`;
                link.click();
                showNotification('Backup criado com sucesso!', 'success');
            });

            document.getElementById('restoreBtn').addEventListener('click', function() {
                document.getElementById('restoreFile').click();
            });

            document.getElementById('restoreFile').addEventListener('change', async function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = async function(e) {
                        const success = await db.restoreData(e.target.result);
                        if (success.success) {
                            showNotification('Dados restaurados com sucesso!', 'success');
                        } else {
                            showNotification('Erro ao restaurar dados. Verifique o arquivo.', 'error', success.error);
                        }
                    };
                    reader.readAsText(file);
                }
            });

            document.getElementById('exportCsvBtn').addEventListener('click', function() {
                const csvData = db.exportCSV();
                const csvBlob = new Blob([csvData], {type:'text/csv'});
                const url = URL.createObjectURL(csvBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `sesap_candidatos_${new Date().toISOString().split('T')[0]}.csv`;
                link.click();
                showNotification('Relat√≥rio CSV exportado com sucesso!', 'success');
            });

            document.getElementById('clearAllBtn').addEventListener('click', function() {
                showConfirmationModal('ATEN√á√ÉO: Esta a√ß√£o ir√° apagar TODOS os dados de TODAS as regi√µes PERMANENTEMENTE. Deseja continuar?', async (result1) => {
                    if (result1) {
                        showConfirmationModal('Tem certeza absoluta? Todos os candidatos cadastrados ser√£o perdidos permanentemente.', async (result2) => {
                            if (result2) {
                                const result = await db.clearAll();
                                if (result.success) {
                                    showNotification('Todos os dados foram apagados.', 'success');
                                } else {
                                    showNotification('Erro ao apagar dados.', 'error', result.error);
                                }
                            }
                        });
                    }
                });
            });
            document.querySelector('.tab-button[data-region="1"]').click();
        });
    </script>
</body>
</ht
